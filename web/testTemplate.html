<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!--CSS ADMINUX -->
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
        <link href="Adminux/css/bootstrap.css" rel="stylesheet" type="text/css"/>
        <link href="Adminux/css/dataTables.bootstrap4.css" rel="stylesheet" type="text/css"/>
        <link href="Adminux/css/responsive.dataTables.min.css" rel="stylesheet" type="text/css"/>
        <link href="Adminux/css/light_adminux.css" rel="stylesheet" type="text/css"/>
        <link href="Adminux/css/theme.css" rel="stylesheet" type="text/css"/>
        
        <!-- JS ADMINUX -->
        <script src="Adminux/js/jquery-2.1.1.min.js" type="text/javascript"></script>
        <script src="Adminux/js/popper.js" type="text/javascript"></script>
        <script src="Adminux/js/bootstrap.min.js" type="text/javascript"></script>
        <script src="Adminux/js/circle-progress.min.js" type="text/javascript"></script>
        <script src="Adminux/js/adminux.js" type="text/javascript"></script>
        <script src="Adminux/js/jquery.dataTables.min.js" type="text/javascript"></script>
        <script src="Adminux/js/jquery.sparkline.min.js" type="text/javascript"></script>
        <script src="Adminux/js/dataTables.bootstrap4.js" type="text/javascript"></script>
        <script src="Adminux/js/dataTables.responsive.min.js" type="text/javascript"></script>
        <style>
          #map {
        height: 550px;
        width: 60%;
       }
        </style>
    </head>
    <body class="menuclose-right">
   <!-- Page Loader -->
   <div class="loader_wrapper align-items-center text-center" style="display: none;">
      <div class="load7 load-wrapper">
         <div class="loader"> Loading... </div>
         <div class="clearfix"></div>
         <br>
         <br>
         <br>
         <br>
         <h4 class="text-white">Petal of Flower</h4>
         <p>Awesome things are getting ready...</p>
      </div>
   </div>
   <!-- Page Loader Ends -->
   <header class="navbar-fixed">
      <nav class="navbar navbar-toggleable-md navbar-inverse bg-faded">
         <div class="sidebar-left"> 
            <a class="navbar-brand imglogo" href="index.html">
            RivotrilYa <img src="Fotos Gestion Farmacia/logo.jpg" width=45em />
            </a>
            <button class="btn btn-link icon-header mr-sm-2 pull-right menu-collapse"><span class="fa fa-bars"></span></button>
         </div>
         <form class="form-inline mr-sm-2  pull-left search-header hidden-md-down">
            <input class="form-control " type="text" placeholder="Search" id="search_header">
            <button class="btn btn-link icon-header " type="submit"><span class="fa fa-search"></span></button>
         </form>
         <div class="d-flex mr-auto"> &nbsp;</div>
         <ul class="navbar-nav content-right">
            <li class="v-devider"></li>
            <li class="nav-item active">
               <button class="btn btn-link icon-header " data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="fa fa-envelope-o"></span> <span class="badge-number bg-success"></span></button>
               <div class="dropdown-menu message-container">
                  <div class="list-unstyled">
                     <a href="#" class="media">
                        <span class="message_userpic"></span>
                        <div class="media-body">
                           <h6 class="mt-0 mb-1">Dhananjay Chauhan</h6>
                           Cras sit amet nibh libero, in gravida nulla. Nulla vel metus scelerisque ante sollicitudin. 
                        </div>
                     </a>
                     <a href="#" class="media">
                        <span class="message_userpic"></span>
                        <div class="media-body">
                           <h6 class="mt-0 mb-1">Max Smith</h6>
                           Cras sit amet nibh libero, in gravida nulla. Nulla vel metus scelerisque ante sollicitudin. 
                        </div>
                     </a>
                     <a href="#" class="media">
                        <span class="message_userpic"></span>
                        <div class="media-body">
                           <h6 class="mt-0 mb-1">Astha Smith</h6>
                           Cras sit amet nibh libero, in gravida nulla. Nulla vel metus scelerisque ante sollicitudin. 
                        </div>
                     </a>
                     <a href="#" class="media">
                        <span class="message_userpic"></span>
                        <div class="media-body">
                           <h6 class="mt-0 mb-1">Tommy Cruszii</h6>
                           Cras sit amet nibh libero, in gravida nulla. Nulla vel metus scelerisque ante sollicitudin. 
                        </div>
                     </a>
                     <a href="#" class="media">
                        <span class="message_userpic"></span>
                        <div class="media-body">
                           <h6 class="mt-0 mb-1">Max Smith</h6>
                           Cras sit amet nibh libero, in gravida nulla. Nulla vel metus scelerisque ante sollicitudin. 
                        </div>
                     </a>
                  </div>
               </div>
            </li>
            <li class="nav-item">
               <button class="btn btn-link icon-header badgeCircle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="fa fa-bell-o"></span><span class="badge-number bg-danger"></span></button>
               <div class="dropdown-menu message-container">
                  <div class="list-unstyled">
                     <div class="media">
                        <span class="alert-block bg-primary"><span class="fa fa-bullhorn"></span></span>
                        <div class="media-body"><b>Max Smith</b> updated post of <b>Astha Smith</b>. Cras sit amet nibh libero, in gravida nulla. Nulla vel metus scelerisque ante sollicitudin.</div>
                     </div>
                     <div class="media">
                        <span class="alert-block bg-warning"><span class="fa fa-bell-o"></span></span>
                        <div class="media-body"><b>Max Smith</b> updated post of <b>Astha Smith</b>. Cras sit amet nibh libero, in gravida nulla. Nulla vel metus scelerisque ante sollicitudin.</div>
                     </div>
                     <div class="media">
                        <span class="alert-block bg-danger"><span class="fa fa-exclamation-triangle"></span></span>
                        <div class="media-body"><b>Max Smith</b> updated post of <b>Astha Smith</b>. Cras sit amet nibh libero, in gravida nulla. Nulla vel metus scelerisque ante sollicitudin.</div>
                     </div>
                     <div class="media">
                        <div class="media-body"><b>Max Smith</b> updated post of <b>Astha Smith</b>. Cras sit amet nibh libero, in gravida nulla. Nulla vel metus scelerisque ante sollicitudin.</div>
                     </div>
                     <div class="media">
                        <div class="media-body"><b>Max Smith</b> updated post of <b>Astha Smith</b>. Cras sit amet nibh libero, in gravida nulla. Nulla vel metus scelerisque ante sollicitudin.</div>
                     </div>
                  </div>
               </div>
            </li>
            <li class="nav-item hidden-xs-down">
               <button class="btn btn-link icon-header " data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="fa fa-th"></span> </button>
               <div class="dropdown-menu message-container box-links">
                  <div class="list-unstyled"> <a href="?#" class="media"> <span class="quick-block "><span class="fa fa-bullhorn"></span></span> </a> <a href="?#" class="media"> <span class="quick-block "><span class="fa fa-bell-o"></span></span> </a> <a href="?#" class="media"> <span class="quick-block "><span class="fa fa-calendar"></span></span> </a> <a href="?#" class="media"> <span class="quick-block "><span class="fa fa-id-card"></span></span> </a> <a href="?#" class="media"> <span class="quick-block "><span class="fa fa-handshake-o"></span></span> </a> <a href="?#" class="media"> <span class="quick-block "><span class="fa fa-camera-retro"></span></span> </a> <a href="?#" class="media"> <span class="quick-block "><span class="fa fa-flask"></span></span> </a> <a href="?#" class="media"> <span class="quick-block "><span class="fa fa-plane"></span></span> </a> <a href="?#" class="media"> <span class="quick-block "><span class="fa fa-pie-chart"></span></span> </a> </div>
               </div>
            </li>
            <li class="v-devider"></li>
            <li class="nav-item "> <a class="btn btn-link icon-header menu-collapse-right" href="#"><span class="fa fa-podcast"></span> </a> </li>
         </ul>
         <div class="sidebar-right pull-right ">
            <ul class="navbar-nav  justify-content-end">
               <li class="nav-item">
                  <button class="btn-link btn userprofile" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="userpic"></span> <span class="text">Usuario</span></button>
                  <div class="dropdown-menu"> <a class="dropdown-item" href="customerprofile.html">Profile</a> <a class="dropdown-item" href="#">Analytics Report</a>            
                  </div>
               </li>
               <li><a href="sign-in2.html" class="btn btn-link icon-header"><span class="fa fa-sign-out"></span></a></li>
            </ul>
         </div>
      </nav>
   </header>
   <div class="sidebar-left">
      <div class="user-menu-items">
         <div class="list-unstyled btn-group">
            <button class="media btn btn-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <span class="message_userpic"><img class="d-flex" src="../img/user-header.png" alt="Generic user image"></span> <span class="media-body"> <span class="mt-0 mb-1">Usuario</span> <small>New Jersey, UK.</small> </span> </button>
            <div class="dropdown-menu"> <a class="dropdown-item" href="customerprofile.html">Mi perfil</a>  <a class="dropdown-item" href="#">Ultimas compras</a>       
            </div>
         </div>
      </div>
      <br class="show">
      <ul class="nav flex-column in" id="side-menu" style="">
      <li class="title-nav">MENU</li>
      <li class="nav-item ">
         <a href="javascript:void(0)" class="menudropdown nav-link show">Sucursales<i class="fa fa-angle-down "></i></a>
         <ul class="nav flex-column nav-second-level  in" style="display: block;">
            <li class="nav-item active"><a href="Sucursales.html" class="nav-link  active"><i class="fa fa-globe"></i> Mapa</a></li>
         </ul>
         <!-- /.nav-second-level --> 
      </li>
      <li class="nav-item ">
         <a href="javascript:void(0)" class="menudropdown nav-link">Productos<i class="fa fa-angle-down "></i></a>
         <ul class="nav flex-column nav-second-level">
            <li class="in nav-item"><a href="Reservas.html" class="nav-link ">Reservas</a></li>
         </ul>
         <!-- /.nav-second-level --> 
      </li>
      <li class="nav-item">
         <a href="javascript:void(0)" class="menudropdown nav-link">Busqueda Laboral <i class="fa fa-angle-down "></i></a>
         <ul class="nav flex-column nav-second-level">
            <li class="nav-item"><a class="nav-link" href="BusquedaLaboral.html">Busqueda Laboral</a></li>
         </ul>
         <!-- /.nav-second-level --> 
      </li>
   </div>
   <div class="wrapper-content">
      <div class="container col-lg-15">
         <div class="row">
            <div class="col-sm-16">
               <div class="card">
                  <div class="card-header">
                     <h6 class="card-title">Step Wizard Thin</h6>
                  </div>
                  <div class="card-body">
                     <div class="container_wizard wizard-thin">
                        <div class="stepwizard">
                           <div class="stepwizard-row setup-panel d-flex">
                              <div class="stepwizard-step col">
                                 <a href="#step-12" class="btn success btn-primary">
                                    <span class="btn-round">1</span>
                                    <p>Fill details<small>Setup guidelines</small></p>
                                 </a>
                              </div>
                              <div class="stepwizard-step col">
                                 <a href="#step-22" class="btn btn-secondary success disabled">
                                    <span class="btn-round">2</span>
                                    <p>Step 2<small>Confirm</small></p>
                                 </a>
                              </div>
                              <div class="stepwizard-step col">
                                 <a href="#step-32" class="btn btn-secondary success disabled">
                                    <span class="btn-round">3</span>
                                    <p>Step 3<small>Make payment</small></p>
                                 </a>
                              </div>
                           </div>
                        </div>
                        <form class="container-fluid p-0">
                           <div class="row setup-content" id="step-12" style="display: flex;">
                              <div class="col-sm-16">
                                 <div class="row">
                                    <div class="col-sm-16">
                                       <h3 class=" mb-2"> Step 1</h3>
                                    </div>
                                 </div>
                                 <br>
                                 <div class="row">
                                    <div id="map"></div>
                                    <div class="col-md-6 col-lg-6 col-xl-6">
                                       <div class="card full-screen-container">
                                          <div class="card-header align-items-start justify-content-between flex">
                                             <h5 class="card-title  pull-left">Sucursales </h5>
                                          </div>
                                          <div class="card-body">
                                             <div id="sucursales" class="list-unstyled comment-list" style="height:400px;">                                                            
                                             </div>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                                 <div class="wizard-footer">
                                    <div class="col-sm-16 ">
                                       <button id="elegirProductos" class="btn btn-primary nextBtn btn-lg pull-right" type="button">Siguiente</button>
                                    </div>
                                 </div>
                              </div>
                           </div>
                           <div class="row setup-content" id="step-22" style="display: none;">
                              <div class="col-sm-16">
                                 <div class="row">
                                    <div class="col-sm-16">
                                       <h3 class=" mb-2"> Step 2</h3>
                                    </div>
                                 </div>
                                 <br>
                                 <div class="row" id="productos">
                                
                                 </div>
                                 <div class="wizard-footer">
                                    <div class="col-sm-16 ">
                                       <button id="elegirPago"class="btn btn-primary nextBtn btn-lg pull-right" type="button">Elegir metodo de pago</button>
                                    </div>
                                 </div>
                              </div>
                           </div>
                           <div class="row setup-content" id="step-32" style="display: none;">
                              <div class="col-sm-16">
                                 <div class="row">
                                    <div class="col-sm-16">
                                       <h3 class=" mb-2"> Step 3</h3>
                                    </div>
                                 </div>
                                 <div class="row">
                                    <div class="col-sm-16">
                                        <div class="row" > 
                                            <div id="metodoPago"></div>
                                            </div>
                            <div class="col-sm-16 col-md-8 col-lg-6">
                                    <div class="form-group">
                                      <label class="form-control-label">Precio</label>
                                      <input type="number" id="precioProd" class="form-control"readonly >
                                    </div>                                    
                       </div>
                                        
                                        
                                  
                                    </div>
                                 </div>
                                 <br>
                                 <div class="wizard-footer">
                                    <div class="col-sm-16 ">
                                       <button class="btn btn-success btn-lg pull-right" type="button" id="pagar">Finish!</button>
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </form>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div> 
   <!-- modal para el producto -->
   <div class="modal fade" id="modalPopUp" tabindex="-1" role="dialog" aria-labelledby="modalPopUpLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">titulo</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
        <button type="button" class="btn btn-primary" data-dismiss="modal" id="agregarProducto">Guardar</button>
      </div>
    </div>
  </div>
</div>
   
   <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCCRkGIJlO76NKI82zhEJ4leGih0-2u46g&callback=initMap&sensor=false&libraries=places,geometry&.js">
    </script>    
    <script src="js/Sucursales/configMapsSucursal.js"></script>
<script>
 
 
 
$(document).on('ready', function() {    
    document.querySelector("#elegirProductos").addEventListener("click",function(){
        if(!ventaProducto.Sucursal){
            alert("no se selecciono sucursal");
            return false;
        }
        var myNode = document.getElementById("productos");
        while (myNode.firstChild) {
            myNode.removeChild(myNode.firstChild);
        }
         fetch('./Medicamentos/ObtenerProductosPorSucursal',{
                    method: "post",
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },  
              body: JSON.stringify({idSucursal:ventaProducto.Sucursal})
                })
        .then(
            function(response) {
                if (response.status !== 200) {
                    console.log('Looks like there was a problem. Status Code: ' +
                        response.status);
                    return;
                }                
                response.json().then(function(data) {                    
                    let i = 0;                    
                    while (i < data.length) {                         
                        let msjVentaLibre = data[i].EsVentaLibre ? `<span class="status success">Venta Libre</span>` : `<span class="status danger">Acercarse a la sucursal</span>`;
                            document.querySelector("#productos").innerHTML += `<div class="col-md-8 col-sm-16 col-lg-8 col-xl-4">
                            <div class="card product">
                              <figure class="product_img  align-items-center justify-content-between d-flex"><a"><img src="Fotos Gestion Farmacia/Ibu600.jpg"></a></figure>
                              <div class="card-body"> <a>
                                <h5 class="card-title "> ${data[i].Nombre}</h5>
                                </a>
                                <h3> ${data[i].Precio}</h3>
                                <p class="card-text">Descripcion producto</p>                                
                                <small>via : ${data[i].Via.Nombre}</small><br>
                                <small>area : ${data[i].Area.Nombre}</small><br>
                                <small>tipo: ${data[i].Tipo.Nombre}</small><br>
                                <small>venta libre :  ${msjVentaLibre} </small><br>
                                <small>proveedor :  ${data[i].Proveedor.Nombre} </small><br>                          
                              </div>
                              <div class="card-body justify-content-between d-flex">
                                     <button type="button" class="btn btn-success btnModlProd" data-precioprod="${data[i].Precio}" data-stockMax="${data[i].Stock}" data-idProd="${data[i].Id}">Añadir al Carrito</button >
                            </div>
                            </div>`;                        
                        i++;                        
                    };                           
                        agregarEventoAbrirModal();
                }                   
        )
        .catch(function(err) {
            console.log('Fetch Error :-S', err);
        });     
    });                     
    },false);
    
    function agregarEventoAbrirModal(){
                  var el = document.querySelectorAll('.btnModlProd');
                for(var i=0; i < el.length; i++){
                    el[i].addEventListener('click', function () {
                        // el sucursalId es el mismo que se le agrega como id al marcador
                        let productoId = this.dataset.idprod;            
                        let stockMax = this.dataset.stockmax;      
                        let precio = this.dataset.precioprod;
                        $("#modalPopUp").modal('show');
                        document.querySelector(".modal-body").innerHTML= `Desea llevar este producto ? 
                        <input type="hidden" value="${productoId}" id="idProd" />
                        <input type="hidden" value="${precio}" id="precio" />
                        <div class="input-group">                                                
                            <input type="text" class="form-control text-center" value="0" id="cantidad">                                                
                            <span>maximo : ${stockMax}</span>
                        </div>`;
                                                      
                    }, false);
                }      
        }   
    
document.querySelector("#agregarProducto").addEventListener('click', function () {
      let idProducto = document.querySelector("#idProd").value;
      let cantidad = document.querySelector("#cantidad").value;
      let precio = document.querySelector("#precio").value;
      if(cantidad == 0){
          alert("no se agrego ningun producto");
          return;
      }
      let producto = {
          idProducto:idProducto, 
          cantidad:cantidad,
          precio : precio
      };
      //todo: verificar si ya tiene el mismo producto en el carrito, si lo tiene quedaria solo sumar la cantidad
      //y verificar si excede del stock maximo.
      ventaProducto.Productos.push(producto);
  },false);
  
  
  
  document.querySelector("#elegirPago").addEventListener("click",function(){
      if(!ventaProducto.Productos){
          alert("no selecciono ningun producto");
          return;
      }          
      //Muestro lo que eligio el cliente
      let opcionesSeleccionadas = `Sucursal: ${ventaProducto.Sucursal} <br> <hr>  Productos  :  `;
      let precioTotal = 0;
      for(let i = 0; i < ventaProducto.Productos.length;i++){
          let prod = ventaProducto.Productos[i];
          precioTotal += prod.precio * prod.cantidad;
          opcionesSeleccionadas += `producto: ${prod.idProducto} Cantidad:  ${prod.cantidad} Precio c/u: ${prod.precio} <br>`;
      }
      opcionesSeleccionadas += '<hr>'
    document.querySelector("#metodoPago").innerHTML = opcionesSeleccionadas;
    document.querySelector("#precioProd").value = precioTotal;
  },false);
  
    //realiza la venta del producto
    document.querySelector("#pagar").addEventListener("click",function(){
          fetch('./PagarProductos',{
                    method: "post",
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },  
              body: JSON.stringify({
                  idSucursal : ventaProducto.Sucursal,
                  productoId : ventaProducto.Productos
            })
                })
        .then(
            function(response) {
                if (response.status !== 200) {
                    console.log('Looks like there was a problem. Status Code: ' +
                        response.status);
                    return;
                }                
                response.json().then(function(data) {                        
                    if(data.success){
                        alert("Se realizo la venta correctamente");
                    }else
                        alert("No se pudo realizar la venta");                        
                }                   
        )
        .catch(function(err) {
            console.log('Fetch Error :-S', err);
        });     
    });       
    },false);
    
    
    
    
    
    $(".container_wizard").each(function() {
        var navListItems = $(this).find('div.setup-panel div a'),
            allWells = $(this).find('.setup-content'),
            allNextBtn = $('.nextBtn');
        allWells.hide();
        navListItems.click(function(e) {
            e.preventDefault();
            var $target = $($(this).attr('href')),
                $item = $(this);
            navListItems.removeClass('btn-primary').addClass('btn-secondary');
            $item.addClass('btn-primary');
            $item.removeClass('btn-secondary');
            $item.removeClass('disabled');
            allWells.hide();
            $target.show();
            $target.find('input:eq(0)').focus();
        });
        allNextBtn.click(function() {
            var curStep = $(this).closest(".setup-content"),
                curStepBtn = curStep.attr("id"),
                nextStepWizard = $('div.setup-panel div a[href="#' + curStepBtn + '"]').parent().next().children("a"),
                curInputs = curStep.find("input[type='text'],input[type='url']"),
                isValid = true;
            $(".form-group").removeClass("has-danger");
            for (var i = 0; i < curInputs.length; i++) {
                if (!curInputs[i].validity.valid) {
                    isValid = false;
                    $(curInputs[i]).closest(".form-group").addClass("has-danger");
                }
            }
            if (isValid)
                nextStepWizard.removeAttr('disabled').trigger('click');
        });
        $(this).find('.setup-panel div a.btn-primary').trigger('click');
    });
});
</script>

    </body>
</html>
